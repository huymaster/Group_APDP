@using Microsoft.AspNetCore.Authorization
@using WebApp.Core
@model Course
@inject IAuthorizationService auth

@{
    var authResult = await auth.AuthorizeAsync(User, null, Policies.CanManageCourses);
    ViewBag.HasManageCourse = authResult.Succeeded;
    var detailsUrl = Url.Action("Details", "Courses", new { id = Model.CourseId });
}

<div id="card-@Model.CourseId" class="card course-card" style="cursor: pointer" data-details-url="@detailsUrl">
    <div class="card-body d-flex">
        <div class="flex-grow-1">
            <h5 class="card-title">@Model.CourseName (@Model.CourseCode)</h5>
            <p class="card-text">@(Model.Description ?? "<No description>")</p>
            <p class="card-text">Assigned to: @(Model.Teacher?.FullName ?? "<no teacher>")</p>
            <div class="row mt-3">
                <p class="col card-text me-1">From: @Model.StartDate.ToString("dd/MM/yyyy")</p>
                <p class="col card-text me-1">To: @Model.EndDate.ToString("dd/MM/yyyy")</p>
            </div>
        </div>
        @if (ViewBag.HasManageCourse)
        {
            <div class="d-flex align-items-end">
                <a class="btn btn-primary m-1" asp-area=""
                   asp-controller="Courses"
                   asp-action="Edit"
                   asp-route-id="@Model.CourseId">
                    Edit
                </a>
                <button class="btn btn-danger m-1"
                        data-bs-toggle="modal"
                        data-bs-target="#deleteCourseModal"
                        data-id="@Model.CourseId">
                    Delete
                </button>
            </div>
        }
    </div>
</div>